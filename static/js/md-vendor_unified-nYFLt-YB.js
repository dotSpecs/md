import{b as P}from"./md-vendor_bail-FqpXQuLt.js";import{e as d}from"./md-vendor_extend-BmjiNja1.js";import{i as z}from"./md-vendor_is-plain-obj-C1gvLhAf.js";import{t as C}from"./md-vendor_trough-B_b8ryxu.js";import{V as A}from"./md-vendor_vfile-C3sb5AyW.js";const S=function(s){const t=this.constructor.prototype,i=t[s],a=function(){return i.apply(a,arguments)};return Object.setPrototypeOf(a,t),a},F={}.hasOwnProperty;class x extends S{constructor(){super("copy"),this.Compiler=void 0,this.Parser=void 0,this.attachers=[],this.compiler=void 0,this.freezeIndex=-1,this.frozen=void 0,this.namespace={},this.parser=void 0,this.transformers=C()}copy(){const e=new x;let r=-1;for(;++r<this.attachers.length;){const t=this.attachers[r];e.use(...t)}return e.data(d(!0,{},this.namespace)),e}data(e,r){return typeof e=="string"?arguments.length===2?(b("data",this.frozen),this.namespace[e]=r,this):F.call(this.namespace,e)&&this.namespace[e]||void 0:e?(b("data",this.frozen),this.namespace=e,this):this.namespace}freeze(){if(this.frozen)return this;const e=this;for(;++this.freezeIndex<this.attachers.length;){const[r,...t]=this.attachers[this.freezeIndex];if(t[0]===!1)continue;t[0]===!0&&(t[0]=void 0);const i=r.call(e,...t);typeof i=="function"&&this.transformers.use(i)}return this.frozen=!0,this.freezeIndex=Number.POSITIVE_INFINITY,this}parse(e){this.freeze();const r=y(e),t=this.parser||this.Parser;return w("parse",t),t(String(r),r)}process(e,r){const t=this;return this.freeze(),w("process",this.parser||this.Parser),g("process",this.compiler||this.Compiler),r?i(void 0,r):new Promise(i);function i(a,h){const p=y(e),u=t.parse(p);t.run(u,p,function(o,c,f){if(o||!c||!f)return n(o);const l=c,m=t.stringify(l,f);O(m)?f.value=m:f.result=m,n(o,f)});function n(o,c){o||!c?h(o):a?a(c):r(void 0,c)}}}processSync(e){let r=!1,t;return this.freeze(),w("processSync",this.parser||this.Parser),g("processSync",this.compiler||this.Compiler),this.process(e,i),T("processSync","process",r),t;function i(a,h){r=!0,P(a),t=h}}run(e,r,t){I(e),this.freeze();const i=this.transformers;return!t&&typeof r=="function"&&(t=r,r=void 0),t?a(void 0,t):new Promise(a);function a(h,p){const u=y(r);i.run(e,u,n);function n(o,c,f){const l=c||e;o?p(o):h?h(l):t(void 0,l,f)}}}runSync(e,r){let t=!1,i;return this.run(e,r,a),T("runSync","run",t),i;function a(h,p){P(h),i=p,t=!0}}stringify(e,r){this.freeze();const t=y(r),i=this.compiler||this.Compiler;return g("stringify",i),I(e),i(e,t)}use(e,...r){const t=this.attachers,i=this.namespace;if(b("use",this.frozen),e!=null)if(typeof e=="function")u(e,r);else if(typeof e=="object")Array.isArray(e)?p(e):h(e);else throw new TypeError("Expected usable value, not `"+e+"`");return this;function a(n){if(typeof n=="function")u(n,[]);else if(typeof n=="object")if(Array.isArray(n)){const[o,...c]=n;u(o,c)}else h(n);else throw new TypeError("Expected usable value, not `"+n+"`")}function h(n){if(!("plugins"in n)&&!("settings"in n))throw new Error("Expected usable value but received an empty preset, which is probably a mistake: presets typically come with `plugins` and sometimes with `settings`, but this has neither");p(n.plugins),n.settings&&(i.settings=d(!0,i.settings,n.settings))}function p(n){let o=-1;if(n!=null)if(Array.isArray(n))for(;++o<n.length;){const c=n[o];a(c)}else throw new TypeError("Expected a list of plugins, not `"+n+"`")}function u(n,o){let c=-1,f=-1;for(;++c<t.length;)if(t[c][0]===n){f=c;break}if(f===-1)t.push([n,...o]);else if(o.length>0){let[l,...m]=o;const E=t[f][1];z(E)&&z(l)&&(l=d(!0,E,l)),t[f]=[n,l,...m]}}}}const k=new x().freeze();function w(s,e){if(typeof e!="function")throw new TypeError("Cannot `"+s+"` without `parser`")}function g(s,e){if(typeof e!="function")throw new TypeError("Cannot `"+s+"` without `compiler`")}function b(s,e){if(e)throw new Error("Cannot call `"+s+"` on a frozen processor.\nCreate a new processor first, by calling it: use `processor()` instead of `processor`.")}function I(s){if(!z(s)||typeof s.type!="string")throw new TypeError("Expected node, got `"+s+"`")}function T(s,e,r){if(!r)throw new Error("`"+s+"` finished async. Use `"+e+"` instead")}function y(s){return j(s)?s:new A(s)}function j(s){return!!(s&&typeof s=="object"&&"message"in s&&"messages"in s)}function O(s){return typeof s=="string"||D(s)}function D(s){return!!(s&&typeof s=="object"&&"byteLength"in s&&"byteOffset"in s)}export{k as u};
